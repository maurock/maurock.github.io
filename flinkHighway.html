<!DOCTYPE html>
<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>CODE</title>

        <!-- Bootstrap core CSS -->
        <link href="vendor/bootstrap/css/bootstrap.css" rel="stylesheet">

        <!-- Custom fonts for this template -->
        <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Raleway:700,200,400,300" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Roboto:700,200,400,300" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">

        <!-- Plugin CSS -->
        <link href="vendor/magnific-popup/magnific-popup.css" rel="stylesheet" type="text/css">

        <!-- Custom styles for this template -->
        <link href="css/code.css" rel="stylesheet">

    </head>

    <body id="page-top">

        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg bg-secondary fixed-top text-uppercase" id="mainNav">
            <div class="container">
                <a class="navbar-brand js-scroll-trigger" style="font-family: Raleway; font-size: 20px;" href="#page-top">Mauro Comi</a>
                <button class="navbar-toggler navbar-toggler-right text-uppercase bg-primary text-white rounded" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fa fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item mx-0 mx-lg-1">
                            <a class="nav-link py-3 px-0 px-lg-3 rounded" href="index.html#portfolio">My Projects</a>
                        </li>
                        <li class="nav-item mx-0 mx-lg-1">
                            <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#about">About me</a>
                        </li>
                        <li class="nav-item mx-0 mx-lg-1">
                            <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#contact">Contact</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>


        <!-- Code -->
        <section class="code" id="prediction">
            <div class="container">
                <h2 class="text-center text-uppercase text-secondary mb-0" style="margin-top: 50px;">Highway patrol</h2>
                <br><br>

                <div class="snippet"><h5><b>Introduction</b></h5>For this Project I used the modified data based on a real dataset used by the Police Department for highway patrol. This dataset is composed of X observations and 8 different variables. In this project we consider that each vehicle reports a position event every 30 seconds with the following format: <i>Time, VID, Spd, XWay, Lane, Dir, Seg, Pos</i>. The goal of this project is to develop a Java program using Flink implementing the following functionality:
                    <ul>
                        <li><b>Speed Radar:</b> detect cars that overcome the speed limit of 90 mph. Format of the output: <br><i>Time, VID, XWay, Seg, Dir, Spd</i></li>
                        <li><b>Average Speed Control:</b> detects cars with an average speed higher than 60 mph between segments 52 and 56 (both included) in both directions. Format of the output: <br>
                        <i>Time1, Time2, VID, XWay, Dir, AvgSpd</i>, where <i>Time1</i> is the time of the first event of the segment and <i>Time2</i> is the time of the last event of the segment.</li>
                        <li><b>Accident Reporter:</b> detects stopped vehicles on any segment. A vehicle is stopped when it reports at least 4 consecutive events from the same position. Format of the output: <br><i>Time1, Time2, VID, XWay, Seg, Dir, Pos</i>, where <i>Time1</i> is the time of the first event the car stops and <i>Time2</i> is the time of the fourth event the car reports to be stopped.</li>
                    </ul>
                    The output will be then 3 .csv files.                   
                     
                    The App was developed using <b>Oracle Java 8, Flink 1.3.2</b> and deployed using <b>Ubuntu</b>.<br> The Flink program is configured with the <b>flink-quickstart-java</b> maven artifact.</div>

                <!-- PRIMA PARTE -->
                <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;background: #ffffff;overflow:auto;width:auto;border: solid #c1c1c1;border-width: .05em .05em .05em .05em;border-radius: 0.5em;padding: 0.8em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">package</span> master2017<span style="color: #333333">.</span><span style="color: #0000CC">flink</span><span style="color: #333333">;</span>

        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.api.common.functions.FilterFunction</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.api.common.functions.MapFunction</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.api.java.tuple.Tuple</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.api.java.tuple.Tuple8</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.api.java.tuple.Tuple6</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.core.fs.FileSystem</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.streaming.api.TimeCharacteristic</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.streaming.api.datastream.DataStream</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.streaming.api.environment.StreamExecutionEnvironment</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.streaming.api.functions.timestamps.AscendingTimestampExtractor</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.streaming.api.functions.windowing.WindowFunction</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.streaming.api.windowing.assigners.EventTimeSessionWindows</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.streaming.api.windowing.time.Time</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.streaming.api.windowing.windows.GlobalWindow</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.streaming.api.windowing.windows.TimeWindow</span><span style="color: #333333">;</span>
        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">org.apache.flink.util.Collector</span><span style="color: #333333">;</span>

        <span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">java.util.*</span><span style="color: #333333">;</span>
        </pre></div>
                
                
                <div class="snippet">The first step is to set the Configuration, the Environment and the input and output parameters. The function <i>setStreamTimeCharacteristic()</i> is set on EventTime. For detailed info about the different notions of time in streaming programs in Flink please refer to this: <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.0/apis/streaming/event_time.html">https://ci.apache.org/projects/flink/flink-docs-release-1.0/apis/streaming/event_time.html</a>.</div>                 
                
                
                <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;background: #ffffff;overflow:auto;width:auto;border: solid #c1c1c1;border-width: .05em .05em .05em .05em;border-radius: 0.5em;padding: 0.8em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">VehicleTelematics</span> <span style="color: #333333">{</span>

    <span style="color: #008800; font-weight: bold">public</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">main</span><span style="color: #333333">(</span>String<span style="color: #333333">[]</span> args<span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">throws</span> Exception <span style="color: #333333">{</span>

        <span style="color: #888888">//Set output paths</span>
        String inputFilePath <span style="color: #333333">=</span> args<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">];</span>
        String outputDirectory <span style="color: #333333">=</span> args<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">];</span>
        String outputPathExercise1 <span style="color: #333333">=</span> outputDirectory <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot;/speedfines.csv&quot;</span><span style="color: #333333">;</span>
        String outputPathExercise2 <span style="color: #333333">=</span> outputDirectory <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot;/avgspeedfines.csv&quot;</span><span style="color: #333333">;</span>
        String outputPathExercise3 <span style="color: #333333">=</span> outputDirectory <span style="color: #333333">+</span> <span style="background-color: #fff0f0">&quot;/accidents.csv&quot;</span><span style="color: #333333">;</span>

        <span style="color: #888888">//Set the Stream execution environment</span>
        <span style="color: #008800; font-weight: bold">final</span> StreamExecutionEnvironment env <span style="color: #333333">=</span> StreamExecutionEnvironment<span style="color: #333333">.</span><span style="color: #0000CC">getExecutionEnvironment</span><span style="color: #333333">();</span>
        env<span style="color: #333333">.</span><span style="color: #0000CC">getConfig</span><span style="color: #333333">().</span><span style="color: #0000CC">disableSysoutLogging</span><span style="color: #333333">();</span>

        <span style="color: #888888">//Set Time Characteristics as Event Time</span>
        env<span style="color: #333333">.</span><span style="color: #0000CC">setStreamTimeCharacteristic</span><span style="color: #333333">(</span>TimeCharacteristic<span style="color: #333333">.</span><span style="color: #0000CC">EventTime</span><span style="color: #333333">);</span>

        <span style="color: #888888">//Read text file</span>
        DataStream<span style="color: #333333">&lt;</span>String<span style="color: #333333">&gt;</span> source <span style="color: #333333">=</span> env<span style="color: #333333">.</span><span style="color: #0000CC">readTextFile</span><span style="color: #333333">(</span>inputFilePath<span style="color: #333333">).</span><span style="color: #0000CC">setParallelism</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">);</span>
</pre></div>
                
                
                <div class="snippet">All the entries in the .csv file are stored into Tuples. In this case, in the object Tuple8 because of the number of variables in the dataset. I stored the instances into two different tuples: the first one is not parallelized, so the order of the instances in this case is not important and the data is not stored according to the data stream. The second one is parallelized: the operation is processed by a single core, so the instances are stored in the correct order of the dataset according to the data stream.
                </div>
                
                <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;background: #ffffff;overflow:auto;width:auto;border: solid #c1c1c1;border-width: .05em .05em .05em .05em;border-radius: 0.5em;padding: 0.8em .6em;"><pre style="margin: 0; line-height: 125%">        <span style="color: #888888">//Get Tuples8 from strings</span>
        <span style="color: #008800; font-weight: bold">final</span> DataStream<span style="color: #333333">&lt;</span>Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;&gt;</span> tuples <span style="color: #333333">=</span> source<span style="color: #333333">.</span>
                map<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> MapFunction<span style="color: #333333">&lt;</span>String<span style="color: #333333">,</span> Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;&gt;()</span> <span style="color: #333333">{</span>
                    <span style="color: #008800; font-weight: bold">public</span> Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;</span> map<span style="color: #333333">(</span>String string<span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">throws</span> Exception <span style="color: #333333">{</span>
                        String<span style="color: #333333">[]</span> split_string <span style="color: #333333">=</span> string<span style="color: #333333">.</span><span style="color: #0000CC">split</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;,&quot;</span><span style="color: #333333">);</span>
                        Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;</span> tuple <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;(</span>Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>split_string<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">]),</span>
                                Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>split_string<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">]),</span> Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>split_string<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">2</span><span style="color: #333333">]),</span> Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>split_string<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">3</span><span style="color: #333333">]),</span> Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>split_string<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">4</span><span style="color: #333333">]),</span> Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>split_string<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">5</span><span style="color: #333333">]),</span>
                                Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>split_string<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">6</span><span style="color: #333333">]),</span> Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>split_string<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">7</span><span style="color: #333333">]));</span>
                        <span style="color: #008800; font-weight: bold">return</span> tuple<span style="color: #333333">;</span>
                    <span style="color: #333333">}</span>
                <span style="color: #333333">});</span>

        <span style="color: #888888">//Get Tuples8 from strings</span>
        <span style="color: #008800; font-weight: bold">final</span> DataStream<span style="color: #333333">&lt;</span>Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;&gt;</span> tuples_parallelized <span style="color: #333333">=</span> source<span style="color: #333333">.</span>
                map<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> MapFunction<span style="color: #333333">&lt;</span>String<span style="color: #333333">,</span> Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;&gt;()</span> <span style="color: #333333">{</span>
                    <span style="color: #008800; font-weight: bold">public</span> Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;</span> map<span style="color: #333333">(</span>String string<span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">throws</span> Exception <span style="color: #333333">{</span>
                        String<span style="color: #333333">[]</span> split_string <span style="color: #333333">=</span> string<span style="color: #333333">.</span><span style="color: #0000CC">split</span><span style="color: #333333">(</span><span style="background-color: #fff0f0">&quot;,&quot;</span><span style="color: #333333">);</span>
                        Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;</span> tuple <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;(</span>Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>split_string<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">]),</span>
                                Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>split_string<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">]),</span> Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>split_string<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">2</span><span style="color: #333333">]),</span> Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>split_string<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">3</span><span style="color: #333333">]),</span> Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>split_string<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">4</span><span style="color: #333333">]),</span> Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>split_string<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">5</span><span style="color: #333333">]),</span>
                                Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>split_string<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">6</span><span style="color: #333333">]),</span> Integer<span style="color: #333333">.</span><span style="color: #0000CC">parseInt</span><span style="color: #333333">(</span>split_string<span style="color: #333333">[</span><span style="color: #0000DD; font-weight: bold">7</span><span style="color: #333333">]));</span>
                        <span style="color: #008800; font-weight: bold">return</span> tuple<span style="color: #333333">;</span>
                    <span style="color: #333333">}</span>
                <span style="color: #333333">}).</span><span style="color: #0000CC">setParallelism</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">);</span>
                </pre></div>
                
                
                
                
                <div class="snippet"><h5><b>Speed radar</b></h5>The goal is to detect all the cars that overcome the speed limit of 90 mph. In order to achieve this result, first filter by the speed overriding the function filter(), and then store the result in a tuple, using the function map(). Finally, the result is written in a .csv file.
                Part of the results is printed: the first number represents the if of the core in charge of that specific computation (there are 8 cores in total), and the last value of the tuple represents the speed for that entry. As we can see, all the values are over 90.</div>
        
            
        <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;background: #ffffff;overflow:auto;width:auto;border: solid #c1c1c1;border-width: .05em .05em .05em .05em;border-radius: 0.5em;padding: 0.8em .6em;"><pre style="margin: 0; line-height: 125%">SingleOutputStreamOperator exercise1 <span style="color: #333333">=</span> tuples<span style="color: #333333">.</span><span style="color: #0000CC">filter</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> FilterFunction<span style="color: #333333">&lt;</span>Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;&gt;()</span> <span style="color: #333333">{</span>
            <span style="color: #555555; font-weight: bold">@Override</span>
            <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">boolean</span> <span style="color: #0066BB; font-weight: bold">filter</span><span style="color: #333333">(</span>Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;</span> tuple_filter<span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">throws</span> Exception <span style="color: #333333">{</span>
                <span style="color: #333399; font-weight: bold">int</span> speed <span style="color: #333333">=</span> tuple_filter<span style="color: #333333">.</span><span style="color: #0000CC">f2</span><span style="color: #333333">;</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>speed <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">90</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
                    <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
                <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">;</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">}).</span><span style="color: #0000CC">map</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> MapFunction<span style="color: #333333">&lt;</span>Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;,</span> Tuple6<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;&gt;()</span> <span style="color: #333333">{</span>
            <span style="color: #008800; font-weight: bold">public</span> Tuple6<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;</span> map<span style="color: #333333">(</span>Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;</span> tuple8<span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">throws</span> Exception <span style="color: #333333">{</span>
                Tuple6<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;</span> tuple6 <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> Tuple6<span style="color: #333333">&lt;&gt;(</span>tuple8<span style="color: #333333">.</span><span style="color: #0000CC">f0</span><span style="color: #333333">,</span> tuple8<span style="color: #333333">.</span><span style="color: #0000CC">f1</span><span style="color: #333333">,</span> tuple8<span style="color: #333333">.</span><span style="color: #0000CC">f3</span><span style="color: #333333">,</span> tuple8<span style="color: #333333">.</span><span style="color: #0000CC">f6</span><span style="color: #333333">,</span> tuple8<span style="color: #333333">.</span><span style="color: #0000CC">f5</span><span style="color: #333333">,</span> tuple8<span style="color: #333333">.</span><span style="color: #0000CC">f2</span><span style="color: #333333">);</span>
                <span style="color: #008800; font-weight: bold">return</span> tuple6<span style="color: #333333">;</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">});</span>

        exercise1<span style="color: #333333">.</span><span style="color: #0000CC">print</span><span style="color: #333333">();</span>
        <br>
        <img src="img/flinkHighway/speed90.jpg" style="height: auto;width: 200px; min-width: 200px;">
        
</pre></div>
                
                 <div class="snippet"><h5><b>Average Speed Control</b></h5>The goal is to detect cars with an average speed higher than 60 mph between segments 52 and 56 (both included) in both directions. It's important to notice that cars that do not complete the segment (52-56) are not taken into account by the average speed control. The number of segment is the 7th variable, so the first step in this task is to filter according to the value of that variable. If this number is included between 52 and 56, I keyed by the variable <i>VID, XWay, Dir</i> and applied a Session Windows with a time gap of 30 seconds. This means that, considering a data stream, a time window closes when no data is transferred for more than 30 seconds. Finally, I filtered by the average speed, which needs to be over 60. In order to do this, I applied a custom Map function called avgFunction(). This function considers all the cars between the segment 52 and 56, and return the first and last timestamp in this interval. Then, the speed is calculated dividing the space between these two segments by the time spent to cover it. All the information are then stored in the collector and written in a csv file. </div>                
                
                
                <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;background: #ffffff;overflow:auto;width:auto;border: solid #c1c1c1;border-width: .05em .05em .05em .05em;border-radius: 0.5em;padding: 0.8em .6em;"><pre style="margin: 0; line-height: 125%"> SingleOutputStreamOperator exercise2 <span style="color: #333333">=</span>
        tuples<span style="color: #333333">.</span><span style="color: #0000CC">filter</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> FilterFunction<span style="color: #333333">&lt;</span>Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;&gt;()</span> <span style="color: #333333">{</span>
            <span style="color: #555555; font-weight: bold">@Override</span>
            <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">boolean</span> <span style="color: #0066BB; font-weight: bold">filter</span><span style="color: #333333">(</span>Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;</span> tuple_filter<span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">throws</span> Exception <span style="color: #333333">{</span>
                <span style="color: #333399; font-weight: bold">int</span> seg <span style="color: #333333">=</span> tuple_filter<span style="color: #333333">.</span><span style="color: #0000CC">f6</span><span style="color: #333333">;</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>seg <span style="color: #333333">&gt;=</span> <span style="color: #0000DD; font-weight: bold">52</span> <span style="color: #333333">&amp;&amp;</span> seg <span style="color: #333333">&lt;=</span> <span style="color: #0000DD; font-weight: bold">56</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
                    <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
                <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">;</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">}).</span><span style="color: #0000CC">assignTimestampsAndWatermarks</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> AscendingTimestampExtractor<span style="color: #333333">&lt;</span>Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;&gt;()</span> <span style="color: #333333">{</span>
            <span style="color: #555555; font-weight: bold">@Override</span>
            <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">long</span> <span style="color: #0066BB; font-weight: bold">extractAscendingTimestamp</span><span style="color: #333333">(</span>Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;</span> element<span style="color: #333333">)</span> <span style="color: #333333">{</span>
                <span style="color: #008800; font-weight: bold">return</span> element<span style="color: #333333">.</span><span style="color: #0000CC">f0</span> <span style="color: #333333">*</span> <span style="color: #0000DD; font-weight: bold">1000</span><span style="color: #333333">;</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">}).</span><span style="color: #0000CC">keyBy</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span><span style="color: #0000DD; font-weight: bold">3</span><span style="color: #333333">,</span><span style="color: #0000DD; font-weight: bold">5</span><span style="color: #333333">)</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">window</span><span style="color: #333333">(</span>EventTimeSessionWindows<span style="color: #333333">.</span><span style="color: #0000CC">withGap</span><span style="color: #333333">(</span>Time<span style="color: #333333">.</span><span style="color: #0000CC">seconds</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">30</span><span style="color: #333333">)))</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">apply</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> avgFunction<span style="color: #333333">()).</span><span style="color: #0000CC">filter</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> FilterFunction<span style="color: #333333">&lt;</span>Tuple6<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Double<span style="color: #333333">&gt;&gt;()</span> <span style="color: #333333">{</span>
            <span style="color: #555555; font-weight: bold">@Override</span>
            <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">boolean</span> <span style="color: #0066BB; font-weight: bold">filter</span><span style="color: #333333">(</span>Tuple6<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Double<span style="color: #333333">&gt;</span> tuple_filter<span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">throws</span> Exception <span style="color: #333333">{</span>
                <span style="color: #333399; font-weight: bold">double</span> speed <span style="color: #333333">=</span> tuple_filter<span style="color: #333333">.</span><span style="color: #0000CC">f5</span><span style="color: #333333">;</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>speed <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">60</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
                    <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
                <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">;</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">});</span>

        <span style="color: #888888">//Write the result in CSV file</span>
        exercise2<span style="color: #333333">.</span><span style="color: #0000CC">writeAsCsv</span><span style="color: #333333">(</span>outputPathExercise2<span style="color: #333333">,</span> FileSystem<span style="color: #333333">.</span><span style="color: #0000CC">WriteMode</span><span style="color: #333333">.</span><span style="color: #0000CC">OVERWRITE</span><span style="color: #333333">).</span><span style="color: #0000CC">setParallelism</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">);</span>
        
        
        <span style="color: #008800; font-weight: bold">private</span> <span style="color: #008800; font-weight: bold">static</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">avgFunction</span> <span style="color: #008800; font-weight: bold">implements</span> WindowFunction<span style="color: #333333">&lt;</span>Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;,</span> Tuple6<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Double<span style="color: #333333">&gt;,</span> Tuple<span style="color: #333333">,</span> TimeWindow<span style="color: #333333">&gt;</span> <span style="color: #333333">{</span>
        <span style="color: #555555; font-weight: bold">@Override</span>
        <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">apply</span><span style="color: #333333">(</span>Tuple tuple<span style="color: #333333">,</span> TimeWindow timeWindow<span style="color: #333333">,</span> Iterable<span style="color: #333333">&lt;</span>Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;&gt;</span> iterable<span style="color: #333333">,</span> Collector<span style="color: #333333">&lt;</span>Tuple6<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Double<span style="color: #333333">&gt;&gt;</span> collector<span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">throws</span> Exception <span style="color: #333333">{</span>
            <span style="color: #333399; font-weight: bold">boolean</span> seg1 <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">,</span> seg2 <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">;</span>
            Tuple stream<span style="color: #333333">;</span>
            List<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">&gt;</span> timestamp <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> ArrayList<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">&gt;();</span>
            List<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">&gt;</span> position <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> ArrayList<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">&gt;();</span>
            <span style="color: #333399; font-weight: bold">int</span> max_time <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">,</span> min_time <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">,</span> max_pos <span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">,</span> min_pos<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">;</span>
            <span style="color: #333399; font-weight: bold">double</span> average<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">;</span>
            <span style="color: #008800; font-weight: bold">for</span> <span style="color: #333333">(</span>Tuple8 element <span style="color: #333333">:</span> iterable<span style="color: #333333">)</span> <span style="color: #333333">{</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">((</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">)</span> element<span style="color: #333333">.</span><span style="color: #0000CC">f6</span> <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">52</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
                    seg1 <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
                    timestamp<span style="color: #333333">.</span><span style="color: #0000CC">add</span><span style="color: #333333">((</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">)</span> element<span style="color: #333333">.</span><span style="color: #0000CC">f0</span><span style="color: #333333">);</span>
                    position<span style="color: #333333">.</span><span style="color: #0000CC">add</span><span style="color: #333333">((</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">)</span> element<span style="color: #333333">.</span><span style="color: #0000CC">f7</span><span style="color: #333333">);</span>
                <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">((</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">)</span> element<span style="color: #333333">.</span><span style="color: #0000CC">f6</span> <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">56</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
                    seg2 <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
                    timestamp<span style="color: #333333">.</span><span style="color: #0000CC">add</span><span style="color: #333333">((</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">)</span> element<span style="color: #333333">.</span><span style="color: #0000CC">f0</span><span style="color: #333333">);</span>
                    position<span style="color: #333333">.</span><span style="color: #0000CC">add</span><span style="color: #333333">((</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">)</span> element<span style="color: #333333">.</span><span style="color: #0000CC">f7</span><span style="color: #333333">);</span>
                <span style="color: #333333">}</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>seg1 <span style="color: #333333">&amp;&amp;</span> seg2<span style="color: #333333">)</span> <span style="color: #333333">{</span>
                    max_time <span style="color: #333333">=</span> Collections<span style="color: #333333">.</span><span style="color: #0000CC">max</span><span style="color: #333333">(</span>timestamp<span style="color: #333333">);</span>
                    min_time <span style="color: #333333">=</span> Collections<span style="color: #333333">.</span><span style="color: #0000CC">min</span><span style="color: #333333">(</span>timestamp<span style="color: #333333">);</span>
                    max_pos <span style="color: #333333">=</span> Collections<span style="color: #333333">.</span><span style="color: #0000CC">max</span><span style="color: #333333">(</span>position<span style="color: #333333">);</span>
                    min_pos <span style="color: #333333">=</span> Collections<span style="color: #333333">.</span><span style="color: #0000CC">min</span><span style="color: #333333">(</span>position<span style="color: #333333">);</span>
                    average <span style="color: #333333">=</span> <span style="color: #333333">(</span>max_pos <span style="color: #333333">-</span> min_pos<span style="color: #333333">)*</span><span style="color: #6600EE; font-weight: bold">2.23693629</span><span style="color: #333333">/(</span>max_time<span style="color: #333333">-</span>min_time<span style="color: #333333">);</span>
                <span style="color: #333333">}</span>
            <span style="color: #333333">}</span>
            collector<span style="color: #333333">.</span><span style="color: #0000CC">collect</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> Tuple6<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Double<span style="color: #333333">&gt;(</span>min_time<span style="color: #333333">,</span> max_time<span style="color: #333333">,</span> tuple<span style="color: #333333">.</span><span style="color: #0000CC">getField</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">),</span> tuple<span style="color: #333333">.</span><span style="color: #0000CC">getField</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">),</span> tuple<span style="color: #333333">.</span><span style="color: #0000CC">getField</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">2</span><span style="color: #333333">),</span> average<span style="color: #333333">));</span>
        <span style="color: #333333">}</span>
    <span style="color: #333333">}</span>


</pre></div>
    
                
                <div class="snippet"><h5><b>Accident Reporter</b></h5>The goal is to detect stopped vehicles on any segment. A vehicle is stopped when it reports at least 4 consecutive events from the same position, and an accident report must be sent for each group of 4 events. A car can be stopped for more than 4 consecutive events, thus multiple accident alerts must be generated in that case. 
                First, I applied a filter to return only the vehicles whose speed is 0. Then, the data stream is keyed by <i>VID, XWay, Dir, Seg, Pos</i>, and a Count Window is applied. The Count Window takes two parameters: the first indicated the number of elements in the window (in our case, 4) and the second integer indicates the slide (in our case, 1).  </div>  


                    
                                   
                <!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;background: #ffffff;overflow:auto;width:auto;border: solid #c1c1c1;border-width: .05em .05em .05em .05em;border-radius: 0.5em;padding: 0.8em .6em;"><pre style="margin: 0; line-height: 125%">SingleOutputStreamOperator exercise3 <span style="color: #333333">=</span> tuples_parallelized<span style="color: #333333">.</span><span style="color: #0000CC">filter</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> FilterFunction<span style="color: #333333">&lt;</span>Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;&gt;()</span> <span style="color: #333333">{</span>
            <span style="color: #555555; font-weight: bold">@Override</span>
            <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">boolean</span> <span style="color: #0066BB; font-weight: bold">filter</span><span style="color: #333333">(</span>Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;</span> tuple_filter<span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">throws</span> Exception <span style="color: #333333">{</span>
                <span style="color: #333399; font-weight: bold">int</span> speed <span style="color: #333333">=</span> tuple_filter<span style="color: #333333">.</span><span style="color: #0000CC">f2</span><span style="color: #333333">;</span>
                <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>speed <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
                    <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">true</span><span style="color: #333333">;</span>
                <span style="color: #333333">}</span> <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">return</span> <span style="color: #008800; font-weight: bold">false</span><span style="color: #333333">;</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">}).</span><span style="color: #0000CC">setParallelism</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">).</span><span style="color: #0000CC">keyBy</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">3</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">5</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">6</span><span style="color: #333333">,</span> <span style="color: #0000DD; font-weight: bold">7</span><span style="color: #333333">).</span><span style="color: #0000CC">countWindow</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">4</span><span style="color: #333333">,</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">)</span>
                <span style="color: #333333">.</span><span style="color: #0000CC">apply</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> accidentFunction<span style="color: #333333">());</span>

        <span style="color: #888888">//Write the result in CSV file</span>
        exercise3<span style="color: #333333">.</span><span style="color: #0000CC">writeAsCsv</span><span style="color: #333333">(</span>outputPathExercise3<span style="color: #333333">,</span> FileSystem<span style="color: #333333">.</span><span style="color: #0000CC">WriteMode</span><span style="color: #333333">.</span><span style="color: #0000CC">OVERWRITE</span><span style="color: #333333">).</span><span style="color: #0000CC">setParallelism</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">);</span>
        
        <span style="color: #008800; font-weight: bold">static</span> <span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">accidentFunction</span> <span style="color: #008800; font-weight: bold">implements</span> WindowFunction<span style="color: #333333">&lt;</span>Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;,</span> Tuple6<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;,</span> Tuple<span style="color: #333333">,</span> GlobalWindow<span style="color: #333333">&gt;</span> <span style="color: #333333">{</span>
        <span style="color: #555555; font-weight: bold">@Override</span>
        <span style="color: #008800; font-weight: bold">public</span> <span style="color: #333399; font-weight: bold">void</span> <span style="color: #0066BB; font-weight: bold">apply</span><span style="color: #333333">(</span>Tuple tuple<span style="color: #333333">,</span> GlobalWindow globalWindow<span style="color: #333333">,</span> Iterable<span style="color: #333333">&lt;</span>Tuple8<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;&gt;</span> iterable<span style="color: #333333">,</span> Collector<span style="color: #333333">&lt;</span>Tuple6<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;&gt;</span> collector<span style="color: #333333">)</span> <span style="color: #008800; font-weight: bold">throws</span> Exception <span style="color: #333333">{</span>
            List<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">&gt;</span> timestamp <span style="color: #333333">=</span> <span style="color: #008800; font-weight: bold">new</span> ArrayList<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">&gt;();</span>
            <span style="color: #333399; font-weight: bold">int</span> max <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">,</span> min <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">;</span>
            <span style="color: #008800; font-weight: bold">for</span> <span style="color: #333333">(</span>Tuple8 element <span style="color: #333333">:</span> iterable<span style="color: #333333">)</span> <span style="color: #333333">{</span>
                timestamp<span style="color: #333333">.</span><span style="color: #0000CC">add</span><span style="color: #333333">((</span><span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">)</span> element<span style="color: #333333">.</span><span style="color: #0000CC">f0</span><span style="color: #333333">);</span>
            <span style="color: #333333">}</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #333333">(</span>timestamp<span style="color: #333333">.</span><span style="color: #0000CC">size</span><span style="color: #333333">()</span> <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">4</span><span style="color: #333333">)</span> <span style="color: #333333">{</span>
                max <span style="color: #333333">=</span> Collections<span style="color: #333333">.</span><span style="color: #0000CC">max</span><span style="color: #333333">(</span>timestamp<span style="color: #333333">);</span>
                min <span style="color: #333333">=</span> Collections<span style="color: #333333">.</span><span style="color: #0000CC">min</span><span style="color: #333333">(</span>timestamp<span style="color: #333333">);</span>
                collector<span style="color: #333333">.</span><span style="color: #0000CC">collect</span><span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">new</span> Tuple6<span style="color: #333333">&lt;</span>Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">,</span> Integer<span style="color: #333333">&gt;(</span>min<span style="color: #333333">,</span> max<span style="color: #333333">,</span> tuple<span style="color: #333333">.</span><span style="color: #0000CC">getField</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #333333">),</span> tuple<span style="color: #333333">.</span><span style="color: #0000CC">getField</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">),</span> tuple<span style="color: #333333">.</span><span style="color: #0000CC">getField</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">2</span><span style="color: #333333">),</span> tuple<span style="color: #333333">.</span><span style="color: #0000CC">getField</span><span style="color: #333333">(</span><span style="color: #0000DD; font-weight: bold">4</span><span style="color: #333333">)));</span>
            <span style="color: #333333">}</span>
        <span style="color: #333333">}</span>
    <span style="color: #333333">}</span>
</pre></div>
                
                    </div>
        </section>



        <!-- Footer -->
    

        <div class="copyright py-4 text-center text-white">
            <div class="container">
                <small>Copyright &copy; Your Website 2017</small>
            </div>
        </div>

        <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
        <div class="scroll-to-top d-lg-none position-fixed ">
            <a class="js-scroll-trigger d-block text-center text-white rounded" href="#page-top">
                <i class="fa fa-chevron-up"></i>
            </a>
        </div>



        <!-- Bootstrap core JavaScript -->
        <script src="vendor/jquery/jquery.min.js"></script>
        <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

        <!-- Plugin JavaScript -->
        <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
        <script src="vendor/magnific-popup/jquery.magnific-popup.min.js"></script>

        <!-- Contact Form JavaScript -->
        <script src="js/jqBootstrapValidation.js"></script>
        <script src="js/contact_me.js"></script>

        <!-- Custom scripts for this template -->
        <script src="js/freelancer.min.js"></script>

    </body>

</html>
